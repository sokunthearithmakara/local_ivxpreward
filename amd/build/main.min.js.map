{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main class for the xpreward plugin\n *\n * @module     local_ivxpreward/main\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Base from 'mod_interactivevideo/type/base';\n\nexport default class XpReward extends Base {\n    /**\n     * Render the container for the annotation\n     * @param {Object} annotation The annotation object\n     * @returns {void}\n     */\n    renderContainer(annotation) {\n        $('#video-wrapper #message[data-id=\"${annotation.id}\"]').remove();\n        $('#video-wrapper').append(`<div id=\"message\" data-id=\"${annotation.id}\"\n             class=\"text-white bg-transparent\" style=\"z-index:105;\">\n            </div>`);\n    }\n\n    completionCallback(annotations, thisItem) {\n        $(`#message[data-id='${thisItem.id}'] #xpreward`).find('button').removeClass('btn-primary').addClass('btn-success');\n        setTimeout(() => {\n            this.player.play();\n        }, 1000);\n    }\n\n    postContentRender(annotation) {\n        let self = this;\n        $(document).off('click', `#message[data-id='${annotation.id}'] #xpreward`)\n            .on('click', `#message[data-id='${annotation.id}'] #xpreward`, function(e) {\n                e.preventDefault();\n                $(this).find('button').prop('disabled', true);\n                $(this).find('button').text(M.util.get_string('claimedxp', 'local_ivxpreward', annotation.xp));\n                self.toggleCompletion(annotation.id, 'mark-done', 'automatic');\n                window.fireConfetti();\n            });\n    }\n\n    /**\n     * What happens when an item runs\n     * @param {Object} annotation The annotation object\n     * @returns {void}\n     */\n    async runInteraction(annotation) {\n        let self = this;\n        await this.player.pause();\n        this.renderContainer(annotation);\n        // We don't need to run the render method every time the content is applied. We can cache the content.\n        if (!self.cache[annotation.id] || self.isEditMode()) {\n            self.cache[annotation.id] = await this.render(annotation);\n        }\n        let content = self.cache[annotation.id];\n        let $message = $(`#message[data-id='${annotation.id}']`);\n        $message.html('<div class=\"modal-body d-flex align-items-center justify-content-center\">' + content + '</div>');\n        this.postContentRender(annotation);\n    }\n}"],"names":["XpReward","Base","renderContainer","annotation","remove","append","id","completionCallback","annotations","thisItem","find","removeClass","addClass","setTimeout","player","play","postContentRender","self","this","document","off","on","e","preventDefault","prop","text","M","util","get_string","xp","toggleCompletion","window","fireConfetti","pause","cache","isEditMode","render","content","html"],"mappings":";;;;;;;uKA0BqBA,iBAAiBC,cAMlCC,gBAAgBC,gCACV,uDAAuDC,6BACvD,kBAAkBC,4CAAqCF,WAAWG,mGAKxEC,mBAAmBC,YAAaC,0DACLA,SAASH,oBAAkBI,KAAK,UAAUC,YAAY,eAAeC,SAAS,eACrGC,YAAW,UACFC,OAAOC,SACb,KAGPC,kBAAkBb,gBACVc,KAAOC,yBACTC,UAAUC,IAAI,oCAA8BjB,WAAWG,oBACpDe,GAAG,oCAA8BlB,WAAWG,oBAAkB,SAASgB,GACpEA,EAAEC,qCACAL,MAAMR,KAAK,UAAUc,KAAK,YAAY,uBACtCN,MAAMR,KAAK,UAAUe,KAAKC,EAAEC,KAAKC,WAAW,YAAa,mBAAoBzB,WAAW0B,KAC1FZ,KAAKa,iBAAiB3B,WAAWG,GAAI,YAAa,aAClDyB,OAAOC,uCASE7B,gBACbc,KAAOC,WACLA,KAAKJ,OAAOmB,aACb/B,gBAAgBC,YAEhBc,KAAKiB,MAAM/B,WAAWG,MAAOW,KAAKkB,eACnClB,KAAKiB,MAAM/B,WAAWG,UAAYY,KAAKkB,OAAOjC,iBAE9CkC,QAAUpB,KAAKiB,MAAM/B,WAAWG,KACrB,+CAAuBH,WAAWG,UACxCgC,KAAK,4EAA8ED,QAAU,eACjGrB,kBAAkBb"}